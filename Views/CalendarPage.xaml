<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:services="clr-namespace:MauiApp1.Services"
             x:Class="MauiApp1.CalendarPage"
             x:Name="Calendar"
             Title="CalendarPage">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <HorizontalStackLayout x:Name="CalendarLayout"
                               Grid.Row="0"
                               Margin="20,16"
                               Padding="0,8"
                               WidthRequest="343"
                               HeightRequest="40">
            <Frame x:Name="BackFrame"
                   BorderColor="Transparent"
                   Margin="0,0,0,8">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnBackButtonTapped" />
                </Frame.GestureRecognizers>
                <Image Source="back_icon.svg"
                       Aspect="AspectFill"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       WidthRequest="24"
                       HeightRequest="24" />
            </Frame>
            <Frame x:Name="CalendarTextFrame"
                   BorderColor="Transparent"
                   HeightRequest="24"
                   Margin="0,0,0,8"
                   WidthRequest="291">
                <Label Text="События"
                       FontSize="20"
                       HorizontalOptions="Center"
                       HeightRequest="24" />
            </Frame>

            <Frame HasShadow="False"
                   HeightRequest="24"
                   Margin="0,0,0,8">
                <StackLayout>
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="EventRedirectTapped" />
                    </StackLayout.GestureRecognizers>
                    <Image Source="events_redirect.svg"/>
                </StackLayout>
            </Frame>
        </HorizontalStackLayout>

        <Frame Grid.Row="1"
               HasShadow="False"
               BorderColor="Transparent"
               Margin="6,8,6,8"
               Padding="10,0"
               HeightRequest="36">
            <Frame HasShadow="True"
                   WidthRequest="136"
                   HorizontalOptions="Start"
                   CornerRadius="8">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="ChoosingATimePeriod" />
                </Frame.GestureRecognizers>
                <StackLayout>
                    <Label Text="{Binding Source={x:Reference Calendar}, Path=TimePeriod}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"
                           Padding="12,6"
                           TextColor="#838281"
                           FontSize="15" />
                </StackLayout>
            </Frame>
        </Frame>

        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <BoxView BackgroundColor="#E4E4E4"
                     HorizontalOptions="FillAndExpand"
                     VerticalOptions="Start"
                     HeightRequest="2"
                     Grid.ColumnSpan="7"
                     Margin="6,0" />

            <Label Text="ПН"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Padding="17,10,10,10" />
            <Label Text="ВТ"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="1"
                   Padding="17,10" />
            <Label Text="СР"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="2"
                   Padding="15,10" />
            <Label Text="ЧТ"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="3"
                   Padding="13,10" />
            <Label Text="ПТ"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="4"
                   Padding="11,10" />
            <Label Text="СБ"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="5"
                   Padding="10" />
            <Label Text="ВС"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   Grid.Column="6"
                   Padding="8,10" />

            <BoxView BackgroundColor="#E4E4E4"
                     HorizontalOptions="FillAndExpand"
                     VerticalOptions="End"
                     HeightRequest="2"
                     Grid.ColumnSpan="7"
                     Margin="6,0" />

            <CollectionView Grid.Row="1"
                            Grid.RowSpan="5"
                            Grid.ColumnSpan="7"
                            ItemsSource="{Binding Days}"
                            Margin="6,0"
                            x:Name="Days">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Span="7"
                                     Orientation="Vertical" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout HeightRequest="105">
                            <HorizontalStackLayout>
                                <Label Text="{Binding Date, StringFormat='{}{0:dd}'}"
                                       HorizontalOptions="Start"
                                       VerticalOptions="Start"
                                       TextColor="{Binding IsCurrentMonth, Converter={StaticResource DateColorConverter}}"
                                       FontFamily="RedRoseBold"
                                       FontSize="15"
                                       Margin="12,6" />
                            </HorizontalStackLayout>

                            <Button Text="{Binding Source={x:Reference Calendar}, Path=EventName, Converter={StaticResource TextDisplayConverter}, ConverterParameter=4}"
                                    FontSize="10"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center"
                                    BackgroundColor="{Binding Source={x:Reference Calendar}, Path=ColorOfAButton}"
                                    TextColor="White"
                                    BorderColor="White"
                                    BorderWidth="1"
                                    HeightRequest="20"
                                    Padding="4,2"
                                    Margin="10,0,0,47"
                                    IsVisible="True"/>

                            <BoxView BackgroundColor="#E4E4E4"
                                     HorizontalOptions="FillAndExpand"
                                     VerticalOptions="End"
                                     HeightRequest="2"
                                     IsVisible="{Binding IsSeparator}" />
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>